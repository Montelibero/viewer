version: "3.9"

services:
  viewer-caddy:
    image: caddy:2-alpine
    container_name: viewer-caddy
    restart: unless-stopped

    # Caddy будет слушать 80 порт внутри контейнера,
    # Traefik ходит к нему по docker-сети.
    networks:
      - web

    volumes:
      # Конфиг Caddy
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      # Статика (HTML/JS/CSS)
      - ./site:/srv:ro
      # Служебные тома Caddy (можно не трогать, но полезно оставить)
      - caddy_data:/data
      - caddy_config:/config

    # Если нужно будет отлаживать без Traefik — можно раскомментировать:
    # ports:
    #   - "8080:80"

    # Пример лейблов под Traefik (если будешь цеплять напрямую):
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.http.routers.viewer.rule=Host(`viewer.eurmtl.me`)"
    #   - "traefik.http.routers.viewer.entrypoints=websecure"
    #   - "traefik.http.routers.viewer.tls.certresolver=myresolver"
    #   - "traefik.http.services.viewer.loadbalancer.server.port=80"

networks:
  web:
    external: true

volumes:
  caddy_data:
  caddy_config:
